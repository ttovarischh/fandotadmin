<p id="notice"><%= notice %></p>

<div class="cover">
  <%= image_tag(@post.image.url, alt: 'Image', class: 'cov') if @post.image? %>
</div>

<%= react_component 'O_PostView', { post: @post, username: @post.user.username, user: @post.user, category: @post.category} %>

<div class="author_buttons">
  <% if user_signed_in? && current_user.id == @post.user_id %>
    <%= link_to edit_post_path(@post) do %>
      <div class="b edit_b"></div>
    <% end %>
  <% end %>
  <% if user_signed_in? && current_user.id == @post.user_id or user_signed_in? && current_user.isadmin %>
    <%= link_to @post, method: :delete, data: { confirm: 'Are you sure?' } do %>
      <div class="b del_b"></div>
    <% end %>
  <% end %>
</div>


<div class="timeline_and_add">

  <div class="timeline">
      <div class="line_container">
        <div class="line"></div>
      </div>
      <div class="allevents">
        <%= render @post.events.select(&:persisted?) %>
      </div>
  </div>

  <div class="add">
    <% if user_signed_in? && current_user.id == @post.user_id  %>
      <p class="popup_title">Новое событие:</p>
      <%= render "events/form" %>
    <% end %>
  </div>
</div>

<div class="actions">
  <div class="votable" id="inside_post">
    <% if user_signed_in? %>
    <% if current_user.voted_down_on? @post %>
  <span>
         <%= link_to unlike_post_path(@post), class: "like", method: :put do %>
         <p class="toggle sleep">-</p>
         <% end %>
       </span>
    <% else %>
    <span>
         <%= link_to unlike_post_path(@post), class: "like", method: :put do %>
         <p class="toggle">-</p>
         <% end %>
       </span>
     <% end %>

     <span><%= @post.cached_votes_score %></span>

            <% if current_user.voted_up_on? @post %>
        <span>
           <%= link_to like_post_path(@post), class: "like", method: :put do %>
             <p class="toggle sleep">+</p>
           <% end %>
         </span>
        <% else %>
        <span>
           <%= link_to like_post_path(@post), class: "like", method: :put do %>
           <p class="toggle">+</p>
           <% end %>
         </span>
        <% end %>
    <% end %>
  </div>
  <div class="buttons">
    <div class="b share_b"></div>

    <% if user_signed_in? %>
          <% pre_favorite = @post.favorites.find { |favorite| favorite.user_id == current_user.id} %>
        <% if pre_favorite %>
            <%= button_to '', post_favorite_path(@post, pre_favorite), method: :delete, class: "b b_filled" %>
        <% else %>
            <%= button_to '', post_favorites_path(@post), method: :post, class: "b b_unfilled" %>
        <% end %>
    <% end %>
    <div class="b sim_b"></div>
  </div>
</div>


<div class="comment_section">
  <h2>Комментарий:</h2>
  <% if user_signed_in? %>
    <div class="input_line">
      <%= link_to image_tag(current_user.avatar.url, class: 'commenter'), current_user %>
      <%= render "comments/form" %>
    </div>
  <% else %>
  <p>Please <%= link_to 'login', new_user_session_path %> or <%= link_to 'register', new_user_registration_path %> to comment.</p>
  <% end %>

  <div class="allin">
      <%= render @post.comments.select(&:persisted?) %>
  </div>
</div>
